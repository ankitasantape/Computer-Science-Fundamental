SQL Practice

1. **List all employees along with their department names.**

SELECT e.id,
       e.first_name,
       e.last_name,
       d.name AS department_name
FROM employees e
JOIN departments d ON e.department_id = d.id;

2. **Find all projects with a budget greater than 1,000,000.**

SELECT id, title, start_date, end_date, budget
FROM projects
where budget > 1000000;

3. **Get the full names of employees working on any project.**

SELECT concat(e.first_name, ' ' , e.last_name) as full_name
FROM employees e
JOIN employees_projects ep ON e.id = ep.employee_id
JOIN projects p ON ep.project_id = p.id;

4. **Find the number of employees in each department.**

SELECT d.name AS department_name, count(e.id) as employee_count
FROM employees e
LEFT JOIN departments d ON e.department_id = d.id
GROUP BY d.name;


5. **List all projects and the number of employees assigned to each.**

SELECT p.title AS project_title, COUNT(ep.employee_id) AS employee_count
FROM projects p
LEFT JOIN employees_projects ep ON p.id = ep.project_id
GROUP BY p.title;

6. **Find employees who are not assigned to any project.**

SELECT e.id, e.first_name, e.last_name
FROM employees e
LEFT JOIN employees_projects ep ON e.id = ep.project_id
WHERE ep.project_id is null;


7. **Find the total salary cost per project (sum of salaries of all assigned employees).**
SELECT p.id as project_id,
       p.title as project_title,
       sum(e.salary) as total_salary_cost
FROM employees e
JOIN employees_projects ep ON e.id = ep.project_id
JOIN projects p on ep.project_id = p.id
GROUP BY p.id, p.title;


8. **List departments with average employee salary greater than 75,000.**

SELECT d.id as department_id,
   d.name as department_name,
   avg(e.salary) as avg_salary
FROM employees e
JOIN departments d on d.id = e.department_id
GROUP BY d.name, d.id
HAVING avg(e.salary) > 75000;


9. **Find the project(s) with the longest duration.**

SELECT  p.id, p.title, p.start_date, p.end_date,
        (p.end_date - p.start_date) AS duration_days
FROM projects p
WHERE (p.end_date - p.start_date) = (
  SELECT MAX(p2.end_date - p2.start_date) 
  FROM projects p2
);


10. **Get the names of employees working on more than 2 projects.**

SELECT e.id,
   CONCAT(e.first_name, ' ', e.last_name) as emp_full_name ,
   COUNT(ep.project_id) as project_count
FROM employees e 
JOIN employees_projects ep 
on e.id = ep.employee_id
GROUP BY e.id, e.first_name, e.last_name
HAVING COUNT(ep.project_id) > 2;

11. For each project list title, budget, total salary

SELECT p.id,
       p.title,
       p.budget,
       COALESCE(sum(e.salary),0) as total_salary
FROM employees e
LEFT JOIN employees_projects ep ON e.id = ep.employee_id
LEFT JOIN projects p ON p.id = ep.project_id
GROUP BY p.id, p.title, p.budget;

12. For each department list departname and name of highest paid employee

SELECT d.name as department_name,
       CONCAT(e.first_name, ' ', e.last_name) as emp_name,
       e.salary
FROM employees e
JOIN departments d ON e.department_id = d.id 
where e.salary = (
  SELECT MAX(e2.salary)
  FROM employees e2
  WHERE e2.department_id = e.department_id
);


13. Eliminate duplicate rows from table employees_projects table. Create the test data

// CREATED TEST DATA
INSERT INTO employees_projects(project_id, employee_id) VALUES(1,3),(1,3),(2,1);

// SEE UPDATED DATA
SELECT ctid, * FROM employees_projects;

// REMOVE DUPLICATE DATA
DELETE FROM employees_projects a 
USING employees_projects b
WHERE a.ctid < b.ctid 
AND a.project_id = b.project_id
AND a.employee_id = b.employee_id;

14. An employee has a reporting Manager. Design the changes. Write a query to show the employee name and Manager Name

// Step 1: Alter Table to Add Manager
ALTER TABLE employees 
ADD COLUMN manager_id INT REFERENCES employees(id);

// Step 2: Insert Test Data
UPDATE employees SET manager_id = NULL WHERE id = 1;
UPDATE employees SET manager_id = 1 WHERE id = 2;
UPDATE employees SET manager_id = 1 WHERE id = 3;
UPDATE employees SET manager_id = 2 WHERE id = 4;
UPDATE employees SET manager_id = 2 WHERE id = 5;
UPDATE employees SET manager_id = 3 WHERE id = 6;

// Step 3: Query Employee with Manager Name

SELECT 
 CONCAT(e.first_name, ' ', e.last_name) as employee_name,
 CONCAT(m.first_name, ' ', m.last_name) as manager_name
FROM employees e
LEFT JOIN employees m
ON e.manager_id = m.id;
 

